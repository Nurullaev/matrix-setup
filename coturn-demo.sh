#!/bin/bash

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Coturn –º–æ–¥—É–ª—è
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è

echo "=== –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø COTURN TURN SERVER –ú–û–î–£–õ–Ø ==="
echo

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤
echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥—É–ª—è:"
echo "   ‚úì modules/coturn_setup.sh - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å"
echo "   ‚úì docs/coturn-setup-guide.md - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"
echo "   ‚úì README.md - –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ Coturn"
echo

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è
echo "2. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—è coturn_setup.sh:"
echo "   ‚úì check_coturn_requirements() - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π"
echo "   ‚úì get_turn_domain() - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ TURN —Å–µ—Ä–≤–µ—Ä–∞"
echo "   ‚úì install_coturn() - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ coturn –ø–∞–∫–µ—Ç–∞"
echo "   ‚úì create_coturn_config() - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
echo "   ‚úì configure_coturn_service() - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ systemd —Å–ª—É–∂–±—ã"
echo "   ‚úì configure_coturn_firewall() - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞"
echo "   ‚úì start_and_verify_coturn() - –∑–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞"
echo "   ‚úì integrate_with_synapse() - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Matrix Synapse"
echo "   ‚úì test_coturn_functionality() - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo "   ‚úì manage_coturn() - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –º–µ–Ω—é"
echo

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤
echo "3. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–∏–ø—ã —Å–µ—Ä–≤–µ—Ä–æ–≤:"
echo "   üè† Proxmox/Home Server:"
echo "      ‚Ä¢ external-ip –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è NAT"
echo "      ‚Ä¢ allowed-peer-ip –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏"
echo "      ‚Ä¢ –ú—è–≥–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (user-quota=20)"
echo
echo "   ‚òÅÔ∏è  –û–±–ª–∞—á–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥:"
echo "      ‚Ä¢ –ü—Ä—è–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ external-ip"
echo "      ‚Ä¢ –°—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (user-quota=8)"
echo "      ‚Ä¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
echo

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω—é
echo "4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å manager-matrix.sh:"
echo "   ‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ –º–µ–Ω—é '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã'"
echo "   ‚úì –°—Ç–∞—Ç—É—Å TURN —Å–µ—Ä–≤–µ—Ä–∞ –≤ –æ–±—â–µ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ"
echo "   ‚úì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–ª—è NAT —Å–µ—Ä–≤–µ—Ä–æ–≤"
echo "   ‚úì –ü—Ä–æ–≤–µ—Ä–∫–∞ VoIP –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã"
echo

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã
echo "5. –¢—Ä–µ–±—É–µ–º—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è TURN —Å–µ—Ä–≤–µ—Ä–∞:"
echo "   üìû 3478/tcp,udp - TURN"
echo "   üîí 5349/tcp,udp - TURN TLS"
echo "   üì° 49152-65535/udp - UDP relay –¥–∏–∞–ø–∞–∑–æ–Ω"
echo

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "6. –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:"
echo "   üîß /etc/turnserver.conf - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è coturn"
echo "   üîë /opt/matrix-install/coturn_secret - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á"
echo "   üìã /opt/matrix-install/coturn_info.conf - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ"
echo "   üè† /etc/matrix-synapse/conf.d/turn.yaml - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Synapse"
echo

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞—á–µ–º –Ω—É–∂–µ–Ω TURN
echo "7. –ö–æ–≥–¥–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º TURN —Å–µ—Ä–≤–µ—Ä:"
echo "   üö® –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ —Å—Ç—Ä–æ–≥–∏–º–∏ NAT/firewall"
echo "   üè¢ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ç–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏"
echo "   üì± –ú–æ–±–∏–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (—á–∞—Å—Ç–æ –±–ª–æ–∫–∏—Ä—É—é—Ç P2P)"
echo "   üè† –°–µ—Ä–≤–µ—Ä—ã –∑–∞ NAT (Proxmox, –¥–æ–º–∞—à–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã)"
echo

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
echo "8. –°–ø–æ—Å–æ–±—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
echo "   üåê Matrix VoIP Tester: https://test.voip.librepush.net/"
echo "   üîß WebRTC ICE Tester: https://webrtc.github.io/samples/..."
echo "   üìä –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ –º–æ–¥—É–ª–µ"
echo

echo "=== –ó–ê–ü–£–°–ö –ú–û–î–£–õ–Ø ==="
echo "–û—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞:"
echo
echo "1. –ß–µ—Ä–µ–∑ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:"
echo "   sudo ./manager-matrix.sh"
echo "   ‚Üí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ‚Üí Coturn TURN Server"
echo
echo "2. –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è:"
echo "   sudo ./modules/coturn_setup.sh"
echo
echo "3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π:"
echo "   –ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Matrix"
echo "   –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –Ω–∏–º –±–µ–∑ –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
echo

echo "=== –†–ï–ó–£–õ–¨–¢–ê–¢ ==="
echo "‚úÖ –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å Coturn TURN Server"
echo "‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –≥–ª–∞–≤–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º matrix-setup"
echo "‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤ (Proxmox, —Ö–æ—Å—Ç–∏–Ω–≥, –¥–æ–º–∞—à–Ω–∏–µ)"
echo "‚úÖ –í–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo "‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Matrix Synapse"
echo "‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"
echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ README —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ VoIP –ø–æ–¥–¥–µ—Ä–∂–∫–µ"
echo

echo "üéâ Matrix Setup Tool —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—ã–µ VoIP –∑–≤–æ–Ω–∫–∏!"
echo "üìû TURN —Å–µ—Ä–≤–µ—Ä –æ–±–µ—Å–ø–µ—á–∏—Ç —Ä–∞–±–æ—Ç—É –∑–≤–æ–Ω–∫–æ–≤ –¥–∞–∂–µ —á–µ—Ä–µ–∑ NAT –∏ firewall"